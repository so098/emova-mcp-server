# 감정-행동 매핑 로직

## 개요

`src/tools/refine-task.ts`는 사용자의 **애매한 할 일 + 현재 감정**을 입력받아, 감정 상태에 맞는 **구체적이고 아주 작은 행동 계획**을 생성하는 도구다.

핵심 아이디어: 감정은 "고쳐야 할 문제"가 아니라 "지금 필요한 행동을 알려주는 신호"이며, 큰 목표 대신 확실히 완수할 수 있는 아주 작은 행동(micro-action)이 자기효능감 회복에 효과적이다.

## `EMOTION_ACTION_MAPPINGS` 배열 구조

4가지 감정 카테고리별로 매핑 데이터를 정의한다.

```typescript
interface EmotionActionMapping {
  emotionPatterns: string[];    // 매칭할 감정 키워드 패턴
  suggestedActions: string[];   // 제안할 작은 행동 목록
  ifThenTemplate: string;       // "만약 ~하면, ~한다" 형식의 실행 의도 템플릿
  rationale: string;            // 왜 이 행동이 도움이 되는지 심리학적 근거
}
```

## 4가지 감정 카테고리별 매핑 테이블

### 1. 무기력 (Lethargy)

| 필드 | 내용 |
|------|------|
| **emotionPatterns** | `"무기력"`, `"지침"`, `"피곤"`, `"귀찮"`, `"힘없"`, `"에너지"` |
| **suggestedActions** | 5분 동안 창문을 열고 바깥 공기를 느껴보기 / 좋아하는 음악 한 곡만 들으며 스트레칭하기 / 따뜻한 물 한 잔 마시며 1분 동안 아무것도 안 하기 / 현관문 밖에 나갔다 들어오기 (30초도 충분) |
| **ifThenTemplate** | "만약 자리에서 일어나기 어렵다면, 먼저 [아주 작은 감각 자극]을 한다" |
| **rationale** | 무기력할 때 큰 목표는 부담. 아주 작은 신체 감각 변화가 뇌의 각성 수준을 올려 다음 행동의 모멘텀을 만든다 (**behavioral activation** 원리) |

### 2. 불안 (Anxiety)

| 필드 | 내용 |
|------|------|
| **emotionPatterns** | `"불안"`, `"걱정"`, `"두려"`, `"긴장"`, `"초조"`, `"떨림"` |
| **suggestedActions** | 지금 걱정되는 것 하나만 메모장에 적기 / 오늘 할 일 중 가장 작은 것 하나만 시작 시간 정하기 / 3분 동안 호흡에 집중하며 숨 세기 (4-7-8 호흡) / 걱정되는 상황의 '최선의 시나리오'를 한 줄로 적기 |
| **ifThenTemplate** | "만약 [걱정되는 상황]이 떠오르면, 먼저 [구체적인 아주 작은 준비 행동]을 한다" |
| **rationale** | 불안은 불확실성에 대한 자연스러운 반응. if-then 계획이 불확실성을 줄이고, **실행 의도(implementation intention)**가 자동적 행동 개시를 돕는다 |

### 3. 자책 (Self-blame)

| 필드 | 내용 |
|------|------|
| **emotionPatterns** | `"자책"`, `"죄책"`, `"후회"`, `"미안"`, `"부끄"`, `"수치"` |
| **suggestedActions** | 자신에게 짧은 격려 메시지 적기 (친한 친구에게 하듯이) / 지금 할 수 있는 아주 작은 자기돌봄 하나 하기 (손 씻기, 얼굴 씻기) / '이미 잘한 것' 한 가지를 메모장에 적기 / 완벽하지 않아도 괜찮다고 3번 천천히 말하기 |
| **ifThenTemplate** | "만약 자책하는 생각이 들면, 먼저 [자기연민 기반 작은 행동]을 한다" |
| **rationale** | 자책은 행동을 위축시킨다. **자기연민(self-compassion)**은 실패를 인간 보편적 경험으로 재해석하여 자기효능감 회복에 도움 (Kristin Neff 연구) |

### 4. 슬픔 (Sadness)

| 필드 | 내용 |
|------|------|
| **emotionPatterns** | `"슬픔"`, `"우울"`, `"외로"`, `"허전"`, `"공허"`, `"서운"` |
| **suggestedActions** | 좋아하는 사진이나 영상 하나만 보기 / 감사한 것 하나를 떠올리며 적기 / 신뢰하는 사람에게 짧은 메시지 보내기 (안부 인사도 충분) / 따뜻한 음료를 만들며 그 과정에 집중하기 |
| **ifThenTemplate** | "만약 마음이 가라앉는 느낌이 들면, 먼저 [작은 연결감이나 위안을 주는 행동]을 한다" |
| **rationale** | 슬픔은 상실/단절에 대한 자연스러운 반응. 작은 사회적 연결이나 감각적 위안이 정서 조절을 돕고 고립감을 줄인다 |

## `findBestMapping()` 함수 동작

```typescript
export function findBestMapping(emotion: string): EmotionActionMapping {
  const lowerEmotion = emotion.toLowerCase();

  for (const mapping of EMOTION_ACTION_MAPPINGS) {
    if (mapping.emotionPatterns.some((p) => lowerEmotion.includes(p))) {
      return mapping;
    }
  }

  // Default: 첫 번째 매핑(무기력) 반환
  return EMOTION_ACTION_MAPPINGS[0];
}
```

### 동작 순서

1. 입력된 감정 문자열을 소문자로 변환
2. `EMOTION_ACTION_MAPPINGS` 배열을 **순차 탐색** (무기력 → 불안 → 자책 → 슬픔)
3. 각 매핑의 `emotionPatterns` 중 하나라도 감정 문자열에 포함되면 해당 매핑 반환
4. 어떤 패턴에도 매칭되지 않으면 **기본값으로 무기력(첫 번째 매핑)** 반환

### 매칭 예시

| 입력 감정 | 매칭 패턴 | 결과 카테고리 |
|-----------|-----------|---------------|
| `"너무 무기력해요"` | `"무기력"` | 무기력 |
| `"시험이 걱정돼요"` | `"걱정"` | 불안 |
| `"또 실수했다 자책중"` | `"자책"` | 자책 |
| `"외로운 밤이에요"` | `"외로"` | 슬픔 |
| `"화가 나요"` | 매칭 없음 | 무기력 (기본값) |
| `"불안하고 자책도 돼요"` | `"불안"` | 불안 (먼저 매칭) |

**주의**: 순차 탐색이므로 여러 감정이 포함된 경우 배열 순서상 먼저 오는 카테고리가 매칭된다.

## `GROWTH_FOCUS_GUIDANCE` — 3가지 성장 방향

```typescript
const GROWTH_FOCUS_GUIDANCE: Record<string, string> = {
  self_efficacy:
    "자기효능감 회복에 초점: '내가 할 수 있다'는 작은 성공 경험을 쌓는 것이 핵심입니다. ...",
  reduce_avoidance:
    "회피 줄이기에 초점: 회피하고 싶은 것에 '아주 조금만' 다가가는 것이 중요합니다. ...",
  self_compassion:
    "자기연민에 초점: 자신을 대하는 방식을 친한 친구를 대하듯 부드럽게 바꾸는 것이 목표입니다. ...",
};
```

| 성장 방향 | 핵심 원리 | 이론적 기반 |
|-----------|-----------|-------------|
| `self_efficacy` | 확실히 완수할 수 있는 아주 작은 행동 → 성공 경험 축적 | Bandura 자기효능감 이론 |
| `reduce_avoidance` | 회피 대상에 아주 조금만 다가가기, 시작 자체가 성공 | 행동 활성화(Behavioral Activation) |
| `self_compassion` | 자신을 친한 친구처럼 대하기, 완벽하지 않아도 OK | Neff 자기연민 이론 |

도구 호출 시 `growth_focus` 파라미터로 전달하면, 해당 가이던스가 결과에 포함된다. 선택적(optional) 파라미터이므로, 제공하지 않으면 성장 방향 가이던스 없이 감정 매핑만 수행한다.

## 이론적 근거 (면접 포인트)

### 1. Bandura의 자기효능감 이론 (Self-Efficacy Theory)

- **핵심**: 자기효능감(내가 할 수 있다는 믿음)은 **mastery experience(성공 경험)**에 의해 가장 강력하게 강화된다
- **적용**: 큰 목표 대신 확실히 달성 가능한 아주 작은 행동을 제안 → 완수 → "나도 할 수 있구나" 경험 축적
- **코드에서**: `suggestedActions`가 모두 5분 이내, 물리적으로 간단한 행동인 이유

### 2. Gollwitzer의 실행 의도 (Implementation Intentions)

- **핵심**: "만약 X 상황이면, Y 행동을 한다" (if-then plan) 형식이 행동 개시를 자동화한다
- **적용**: `ifThenTemplate`이 if-then 형식을 따르는 이유. 의지력에 의존하지 않고 상황-행동을 연결
- **코드에서**: 각 감정 카테고리마다 if-then 템플릿을 제공하고, Claude가 사용자 맥락에 맞게 구체화

### 3. Behavioral Activation (행동 활성화)

- **핵심**: 우울/무기력할 때 활동을 줄이면 악순환. 아주 작은 활동부터 시작하면 보상 경험이 행동을 강화
- **적용**: 무기력 카테고리에서 신체 감각 변화(창문 열기, 스트레칭)를 우선 제안하는 이유
- **코드에서**: `EMOTION_ACTION_MAPPINGS[0]`(무기력)이 기본값인 이유 — 가장 보편적이고 안전한 접근

### 4. Self-Compassion (자기연민) — Kristin Neff

- **핵심**: 실패 시 자책 대신 자기연민(self-kindness + common humanity + mindfulness)이 회복을 돕는다
- **적용**: 자책 카테고리에서 "친한 친구에게 하듯" 격려 메시지를 쓰도록 제안
- **코드에서**: `sensitivity_notes`에 자기연민 언어 사용 지침 포함

## 도구 출력 구조

`refine_ambiguous_task` 도구의 반환 JSON 구조:

```json
{
  "raw_task": "사용자가 입력한 원래 할 일",
  "current_emotion": "사용자가 보고한 감정",
  "growth_focus": "self_efficacy | reduce_avoidance | self_compassion | null",
  "clarified_goal": "감정을 인정하는 공감 메시지 + 작은 시작 제안",
  "if_then_plan": {
    "template": "만약 ~하면, ~한다 (if-then 템플릿)",
    "suggested_actions": ["작은 행동 1", "작은 행동 2", ...],
    "instruction": "행동을 골라 if-then에 넣어 계획을 만들라는 안내"
  },
  "rationale_for_user": "왜 이 행동이 도움이 되는지 근거",
  "sensitivity_notes": ["감정 다루기 가이드라인 5개"],
  "growth_guidance": "선택된 성장 방향 가이던스 (optional)",
  "framework_note": "Claude가 이 구조를 바탕으로 최종 응답 생성하라는 지시",
  "disclaimer": "연구·교육·제품 설계 참고용 면책 조항"
}
```

이 JSON은 Claude에게 반환되고, Claude가 이를 바탕으로 사용자에게 **자연스럽고 따뜻한 언어**로 최종 응답을 생성한다. 도구 자체는 구조화된 데이터만 제공하고, 사용자 커뮤니케이션은 Claude가 담당하는 분리 구조.
